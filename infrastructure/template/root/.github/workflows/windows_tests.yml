# workflow name
name: Windows Tests

# Controls when the action will run. Triggers the workflow on push or pull request
# events but only for the wanted branches
on:
  push:
    branches:
      - master
      - main
  pull_request:
    branches:
      - master
      - main

jobs:
  windows_tests:
    runs-on: windows-latest

    steps:
      - uses: actions/checkout@v2
        with:
          submodules: true

      - name: Choco install qgis
        uses: crazy-max/ghaction-chocolatey@v1
        with:
          args: install qgis-ltr -y

      # If QGIS ltr version is different that 3.16, change the path accordingly
      - name: Run tests
        shell: pwsh
        run: |
          $env:PATH="C:\Program Files\QGIS 3.16\bin;$env:PATH"
          $env:QGIS_PLUGIN_IN_CI=1
          python-qgis-ltr.bat -m pip install -q pytest
          python-qgis-ltr.bat -m pytest -v
